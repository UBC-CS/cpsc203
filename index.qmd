---
title: "{{< var course.full-title >}}"
listing:
  id: most-recent-announcement
  contents: posts
  sort: "date desc"
  type: default
  max-items: 1
  fields: [title, subtitle, description, date, image, reading-time]
execute:
  freeze: false
---

**Instructor:** {{< var instructor.name >}} ({{< var instructor.pronouns >}})\

::::: columns
::: {.column width="50%"}
**Contact**\
üìß [cheeren\@cs.ubc.ca](mailto:cheeren@cs.ubc.ca)\
‚è∞ Mon 2‚Äì4pm [appointment](https://calendly.com/cheeren-cs/oh-appt)\
üè¢ ICCS 233 ¬∑ <a href="https://ubc.zoom.us/j/5393867685?pwd=N01ZS2dLbVorQkRzcDRuNTdwQmRYUT09"><img src="https://upload.wikimedia.org/wikipedia/commons/7/7b/Zoom_Communications_Logo.svg" alt="Zoom" style="height:12px; vertical-align:middle;"></a>
:::

::: {.column width="50%"}
**Class**\
{{< var course.time >}}\
[360 HR MacMillan Building](https://maps.ubc.ca/?code=MCML)\
Livestream <a href="https://canvas.ubc.ca/courses/170624/external_tools/61556"><img src="https://upload.wikimedia.org/wikipedia/commons/7/7b/Zoom_Communications_Logo.svg" alt="Zoom" style="height:12px; vertical-align:middle;"></a>
:::
:::::

## Weekly announcement

::: {#most-recent-announcement}
:::

```{r}
#| label: setup
#| echo: false
#| message: false

library(conflicted)
library(dplyr)
conflicts_prefer(dplyr::filter)
library(fontawesome)
library(fs)
library(glue)
library(gt)
library(gtExtras)
library(here)
library(lubridate)
library(readr)
library(stringr)
library(tidyr)

# Generate ids for each link to join into schedule
resources_paths <-
  c(
    path("slides")
  )

resources <-
  tibble(
    path = dir_ls(resources_paths, glob = "*.qmd"),
    week = path |> path_file() |> str_extract("^(\\d+).*$", group = 1),
    day = path |>
      path_file() |>
      str_extract("\\d+_([:alpha:]+)_.*$", group = 1),
    type = path |> path_dir()
  ) |>
  # Remove unassigned resources indicated by "tbd"
  filter(!str_detect(path, "tbd")) |>
  select(week, type, day, path) |>
  pivot_wider(names_from = c(day, type), names_sep = "_", values_from = path)

current_date <- today()

schedule <- read_csv(here("data", "schedule.csv"), show_col_types = FALSE) |>
  left_join(resources, by = join_by(week), na_matches = "never") |>
  relocate(tue_slides, .before = tue_activity) |>
  relocate(thu_slides, .before = thu_activity) |>
  mutate(
    saturday_before = floor_date(
      date,
      unit = "week",
      week_start = "Sat"
    ),
    show_week = case_when(
      # Show at least the first week in schedule
      date == min(date) ~ TRUE,
      # Show upcoming week on the Saturday before
      saturday_before <= current_date ~ TRUE,
      .default = FALSE
    ),
    upcoming_exam_due = exam_due
  ) |>
  fill(upcoming_exam_due, .direction = "up") |>
  mutate(
    exam_due_within_12_days = upcoming_exam_due <= current_date + days(12)
  )
```

```{r}
#| label: schedule
#| echo: false

schedule |>
  mutate(
    # Show only resources for exams due within 12 days or before
    exam = if_else(
      exam_due_within_12_days,
      glue("[{exam}](https://us.prairietest.com)", .na = NULL),
      exam
    ),
    exam_practice = if_else(
      exam_due_within_12_days,
      exam_practice,
      NA
    ),
    # Remove any resources from future weeks
    across(
      starts_with(c("tue", "thu", "lab", "potw")),
      \(column) if_else(show_week, column, NA)
    )
  ) |>
  gt(
    # groupname_col = "part"
  ) |>
  cols_hide(
    c(
      part,
      saturday_before,
      show_week,
      upcoming_exam_due,
      exam_due_within_12_days
    )
  ) |>
  fmt_date(
    date,
    date_style = "MMMd"
  ) |>
  sub_missing(
    missing_text = ""
  ) |>
  fmt_url(
    columns = ends_with("slides"),
    label = fa("window-maximize")
  ) |>
  sub_missing(
    columns = ends_with("slides"),
    missing_text = fa("window-maximize", fill_opacity = 0.1)
  ) |>
  fmt_url(
    columns = ends_with("activitiy"),
    label = fa("file-alt")
  ) |>
  sub_missing(
    columns = ends_with("activity"),
    missing_text = fa("file-alt", fill_opacity = 0.1)
  ) |>
  fmt_url(
    columns = ends_with("video"),
    label = fa("circle-play")
  ) |>
  sub_missing(
    columns = ends_with("video"),
    missing_text = fa("circle-play", fill_opacity = 0.1)
  ) |>
  fmt_url(
    columns = lab,
    label = fa("laptop-code")
  ) |>
  sub_missing(
    columns = lab,
    missing_text = fa("laptop-code", fill_opacity = 0.1)
  ) |>
  fmt_url(
    columns = potw,
    label = fa("calendar-week")
  ) |>
  sub_missing(
    columns = potw,
    missing_text = fa("calendar-week", fill_opacity = 0.1)
  ) |>
  fmt_url(
    columns = project,
    label = fa("list-check")
  ) |>
  sub_missing(
    columns = project,
    missing_text = fa("clipboard-list", fill_opacity = 0.1)
  ) |>
  fmt_date(
    project_due,
    date_style = "MMMd"
  ) |>
  fmt_url(
    columns = exam,
    rows = exam_due_within_12_days,
    show_underline = FALSE
  ) |>
  fmt_date(
    exam_due,
    date_style = "MMMd"
  ) |>
  fmt_url(
    columns = exam_practice,
    label = fa("pen-to-square")
  ) |>
  sub_missing(
    columns = exam_practice,
    missing_text = fa("pen-to-square", fill_opacity = 0.1)
  ) |>
  cols_label(
    week = "Week",
    date = "Mon",
    tue_slides = "S",
    tue_activity = "A",
    tue_video = "V",
    thu_slides = "S",
    thu_activity = "A",
    thu_video = "V",
    lab = "Lab",
    potw = "POTW",
    project = "Guide",
    project_due = "Due",
    exam = "Book",
    exam_due = "Due",
    exam_practice = "Practice"
  ) |>
  tab_spanner(
    label = "Tue",
    columns = starts_with("tue")
  ) |>
  tab_spanner(
    label = "Thu",
    columns = starts_with("thu")
  ) |>
  tab_spanner(
    label = "Project",
    columns = starts_with("project")
  ) |>
  tab_spanner(
    label = "Examlet",
    columns = c(exam, exam_due, exam_practice)
  ) |>
  cols_align(
    align = "center",
    columns = c(lab, potw, exam_practice)
  ) |>
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = list(
      cells_row_groups(),
      cells_stubhead(),
      cells_column_labels(),
      cells_column_spanners()
    )
  ) |>
  gt_highlight_rows(
    row = date == floor_date(current_date, unit = "week", week_start = "Mon"),
    fill = "#ccefff"
  ) |>
  tab_options(
    quarto.disable_processing = TRUE,
    table.width = "100%"
  )
```
