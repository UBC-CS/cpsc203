<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 850 320">
  <style>
    .title { font-family: 'Open Sans', sans-serif; font-size: 16px; font-weight: bold; }
    .label { font-family: 'Open Sans', sans-serif; font-size: 11px; font-weight: bold; }
    .small { font-family: 'Open Sans', sans-serif; font-size: 10px; }
    .code { font-family: 'Fira Code', monospace; font-size: 9px; }
    .header { font-family: 'Open Sans', sans-serif; font-size: 9px; font-weight: bold; fill: white; }
    .cell { font-family: 'Fira Code', monospace; font-size: 8px; }
  </style>

  <!-- Title -->
  <text x="425" y="25" text-anchor="middle" class="title">Reshaping Data for Plotting: groupby + unstack</text>

  <!-- Original format -->
  <g transform="translate(30, 50)">
    <text x="80" y="-5" text-anchor="middle" class="label" fill="#1976d2">Original Format</text>
    <text x="80" y="8" text-anchor="middle" class="small" fill="#666">(one row per song per week)</text>

    <rect x="0" y="15" width="50" height="16" fill="#1976d2"/>
    <rect x="50" y="15" width="70" height="16" fill="#1976d2"/>
    <rect x="120" y="15" width="35" height="16" fill="#1976d2"/>

    <text x="25" y="26" text-anchor="middle" class="header">date</text>
    <text x="85" y="26" text-anchor="middle" class="header">title</text>
    <text x="137" y="26" text-anchor="middle" class="header">rank</text>

    <rect x="0" y="31" width="155" height="14" fill="#e3f2fd" stroke="#90caf9"/>
    <text x="25" y="41" text-anchor="middle" class="cell">Jan-04</text>
    <text x="85" y="41" text-anchor="middle" class="cell">Song A</text>
    <text x="137" y="41" text-anchor="middle" class="cell">1</text>

    <rect x="0" y="45" width="155" height="14" fill="#fff" stroke="#90caf9"/>
    <text x="25" y="55" text-anchor="middle" class="cell">Jan-04</text>
    <text x="85" y="55" text-anchor="middle" class="cell">Song B</text>
    <text x="137" y="55" text-anchor="middle" class="cell">15</text>

    <rect x="0" y="59" width="155" height="14" fill="#e3f2fd" stroke="#90caf9"/>
    <text x="25" y="69" text-anchor="middle" class="cell">Jan-11</text>
    <text x="85" y="69" text-anchor="middle" class="cell">Song A</text>
    <text x="137" y="69" text-anchor="middle" class="cell">3</text>

    <rect x="0" y="73" width="155" height="14" fill="#fff" stroke="#90caf9"/>
    <text x="25" y="83" text-anchor="middle" class="cell">Jan-11</text>
    <text x="85" y="83" text-anchor="middle" class="cell">Song B</text>
    <text x="137" y="83" text-anchor="middle" class="cell">1</text>

    <text x="77" y="100" text-anchor="middle" class="cell">...</text>
  </g>

  <!-- Arrow 1 -->
  <path d="M 200 100 L 270 100" stroke="#666" stroke-width="2" marker-end="url(#arrow4)"/>
  <text x="235" y="85" text-anchor="middle" class="code">.groupby()</text>

  <!-- Grouped format -->
  <g transform="translate(290, 50)">
    <text x="90" y="-5" text-anchor="middle" class="label" fill="#f57c00">Grouped</text>
    <text x="90" y="8" text-anchor="middle" class="small" fill="#666">(multi-index: date, title)</text>

    <rect x="0" y="15" width="50" height="16" fill="#f57c00"/>
    <rect x="50" y="15" width="70" height="16" fill="#f57c00"/>
    <rect x="120" y="15" width="35" height="16" fill="#f57c00"/>

    <text x="25" y="26" text-anchor="middle" class="header">date</text>
    <text x="85" y="26" text-anchor="middle" class="header">title</text>
    <text x="137" y="26" text-anchor="middle" class="header">rank</text>

    <rect x="0" y="31" width="155" height="14" fill="#fff3e0" stroke="#ffcc80"/>
    <text x="25" y="41" text-anchor="middle" class="cell">Jan-04</text>
    <text x="85" y="41" text-anchor="middle" class="cell">Song A</text>
    <text x="137" y="41" text-anchor="middle" class="cell">1</text>

    <rect x="0" y="45" width="155" height="14" fill="#fff3e0" stroke="#ffcc80"/>
    <text x="25" y="55" text-anchor="middle" class="cell">Jan-04</text>
    <text x="85" y="55" text-anchor="middle" class="cell">Song B</text>
    <text x="137" y="55" text-anchor="middle" class="cell">15</text>

    <rect x="0" y="59" width="155" height="14" fill="#fff3e0" stroke="#ffcc80"/>
    <text x="25" y="69" text-anchor="middle" class="cell">Jan-11</text>
    <text x="85" y="69" text-anchor="middle" class="cell">Song A</text>
    <text x="137" y="69" text-anchor="middle" class="cell">3</text>

    <rect x="0" y="73" width="155" height="14" fill="#fff3e0" stroke="#ffcc80"/>
    <text x="25" y="83" text-anchor="middle" class="cell">Jan-11</text>
    <text x="85" y="83" text-anchor="middle" class="cell">Song B</text>
    <text x="137" y="83" text-anchor="middle" class="cell">1</text>
  </g>

  <!-- Arrow 2 -->
  <path d="M 460 100 L 530 100" stroke="#666" stroke-width="2" marker-end="url(#arrow4)"/>
  <text x="495" y="85" text-anchor="middle" class="code">.unstack()</text>

  <!-- Pivoted format -->
  <g transform="translate(550, 50)">
    <text x="110" y="-5" text-anchor="middle" class="label" fill="#2e7d32">Plot-Ready Format</text>
    <text x="110" y="8" text-anchor="middle" class="small" fill="#666">(one column per song)</text>

    <rect x="0" y="15" width="50" height="16" fill="#2e7d32"/>
    <rect x="50" y="15" width="70" height="16" fill="#2e7d32"/>
    <rect x="120" y="15" width="70" height="16" fill="#2e7d32"/>

    <text x="25" y="26" text-anchor="middle" class="header">date</text>
    <text x="85" y="26" text-anchor="middle" class="header">Song A</text>
    <text x="155" y="26" text-anchor="middle" class="header">Song B</text>

    <rect x="0" y="31" width="190" height="14" fill="#e8f5e9" stroke="#a5d6a7"/>
    <text x="25" y="41" text-anchor="middle" class="cell">Jan-04</text>
    <text x="85" y="41" text-anchor="middle" class="cell">1</text>
    <text x="155" y="41" text-anchor="middle" class="cell">15</text>

    <rect x="0" y="45" width="190" height="14" fill="#fff" stroke="#a5d6a7"/>
    <text x="25" y="55" text-anchor="middle" class="cell">Jan-11</text>
    <text x="85" y="55" text-anchor="middle" class="cell">3</text>
    <text x="155" y="55" text-anchor="middle" class="cell">1</text>

    <rect x="0" y="59" width="190" height="14" fill="#e8f5e9" stroke="#a5d6a7"/>
    <text x="25" y="69" text-anchor="middle" class="cell">Jan-18</text>
    <text x="85" y="69" text-anchor="middle" class="cell">5</text>
    <text x="155" y="69" text-anchor="middle" class="cell">2</text>

    <text x="95" y="90" text-anchor="middle" class="cell">...</text>
  </g>

  <!-- Arrow to plot -->
  <path d="M 750 80 L 790 80 L 790 150" stroke="#666" stroke-width="2" marker-end="url(#arrow4)"/>
  <text x="805" y="120" text-anchor="middle" class="code" transform="rotate(90, 805, 120)">.plot()</text>

  <!-- Bottom explanation -->
  <g transform="translate(30, 200)">
    <rect x="0" y="0" width="790" height="100" rx="8" fill="#fafafa" stroke="#ddd"/>
    <text x="20" y="22" class="small" fill="#333">
      <tspan font-weight="bold">Why reshape?</tspan> Plotting libraries expect one column = one line on the chart.
    </text>
    <text x="20" y="40" class="small" fill="#333">
      Our original data has all songs in one column. We need each song in its own column!
    </text>
    <text x="20" y="65" class="code" fill="#1976d2">plot_data = df.groupby(['date', 'title'])['rank'].sum().unstack()</text>
    <text x="20" y="85" class="code" fill="#1976d2">plot_data.plot()  # Each column becomes a line!</text>
  </g>

  <defs>
    <marker id="arrow4" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#666"/>
    </marker>
  </defs>
</svg>
